# Standalone application
Ready-to-use applications (no need for Python installation) for macOS are available in the Releases section. Download the installer and drag "BabelBrain" into the Applications folder. The first time you will use you may be prompted to authorize it to run and access directories. You may also need to authorize it in the Security settings of macOS.

## Extra requirements 

### FSL
Be sure [FSL](https://fsl.fmrib.ox.ac.uk/fsl/fslwiki) is installed and init scripts are properly activated in your .bash_profile or .zsh_profile.

### SimbNIBS
While BabelBrain does not invoke directly SimbNIBS tools, BabelBrain depends on the output generated by SimbNIBS 3.x `headreco` or SimbNIBS 4.x `charm` processing tools. Consult the [Releases](https://github.com/simnibs/simnibs/releases) section in SimNIBS for installation options. We recommended using SimbNIBS 4.x `charm` for better results.

### Navigation-planning software
It is highly recommended to use a planning software to establish the target localization and orientation, called **trajectory** in the following of this documentation, of the ultrasound transducer for the simulation of transcranial ultrasound. BabelBrain can import trajectories defined in proprietary software (Rogue Research's Brainsight) or open-source visualization software ([3DSlicer](https://www.slicer.org/)). Instructions are detailed in the pipeline section of this documentation.

# Manual Installation 
If you prefer to run the code in a Python environment (in Linux, for example), the requirements are roughly a clean Python 3.9 environment and a healthy XCode installation with command line tools installed in MacOS or an LTS Ubuntu installation such as 20.04. Consult [BabelViscoFDTD](https://github.com/ProteusMRIgHIFU/BabelViscoFDTD) for details on what is needed for the FDTD solver. 

BabelBrain's main target environments are MacOS (ARM64 and Intel X64) and Linux (Intel X64). Some Python's dependencies required by BabelBrain are stable mainly in macOS or Linux. Windows users can run BabelBrain via [WSL2](https://learn.microsoft.com/en-us/windows/wsl/install) with NVidia GPUs (see this [guide](https://docs.nvidia.com/cuda/wsl-user-guide/index.html)). 

* Python 3.9. Anaconda/miniconda is recommended. - if running in Apple new ARM64 processors (M1, M1 Max, etc.), be sure of using a native ARM64 version. Consult [BabelViscoFDTD](https://github.com/ProteusMRIgHIFU/BabelViscoFDTD) for further details.

### Recommended settings
Create first and activate a new environment with some basics libraries from Conda

  `conda create --name babel python=3.9.13 numpy=1.23.3 scipy=1.9.1 matplotlib=3.6.0`

  `activate babel`

Install dependencies with 

`pip install -r requirements.txt`

*Note: BabelBrain uses `antspyx`, which can take longtime to compile*.
### Running
Change to the `BabelBrain/BabelBrain` directory and run

`python BabelBrain.py`

### Building standalone application
A Pyinstaller specification file is provided to build the macOS application. In the `BabelBrain/BabelBrain` directory run

`pyinstaller BabelBrain.spec`

A new application will be created at `BabelBrain/BabelBrain/dist/`

A dmg image installer can be created with the `BabelBrain/BabelBrain/create_dmg.sh` script. You need to install `create-dmg` tool with homebrew. 